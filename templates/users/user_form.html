{% extends 'equipment/dashboard.html' %}

{% block content %}
<div class="container mt-4">
    <h2>{% if form.instance.pk %}Editar Usuario{% else %}Crear Usuario{% endif %}</h2>
    <form method="post" novalidate>
        {% csrf_token %}
        <div class="row">
            <div class="mb-3 col-md-6">
                <label class="form-label">Nombre</label>
                <input type="text" name="first_name" id="first_name" class="form-control capitalize-input" required>
                <div class="invalid-feedback" id="error_first_name"></div>
            </div>
            <div class="mb-3 col-md-6">
                <label class="form-label">Apellido</label>
                <input type="text" name="last_name" id="last_name" class="form-control capitalize-input" required>
                <div class="invalid-feedback" id="error_last_name"></div>
            </div>
            <div class="mb-3 col-md-6">
                <label class="form-label">Cédula</label>
                <div class="input-group">
                    <select class="form-select" name="nacionalidad" id="nacionalidad">
                        <option value="V-">V-</option>
                        <option value="E-">E-</option>
                    </select>
                    <input type="text" name="cedula" id="cedula" class="form-control" maxlength="8" pattern="[0-9]{7,8}" required>
                </div>
                <div class="invalid-feedback" id="error_cedula"></div>
            </div>
            <div class="mb-3 col-md-6">
                <label class="form-label">Correo Electrónico</label>
                <input type="email" name="email" id="email" class="form-control capitalize-input" required>
                <div class="invalid-feedback" id="error_email"></div>
            </div>
            <div class="mb-3 col-md-6">
                <label class="form-label">Celular</label>
                <input type="text" name="celular" id="celular" class="form-control" maxlength="11" pattern="[0-9]{11}" required>
                <div class="invalid-feedback" id="error_celular"></div>
            </div>
            <div class="mb-3 col-md-6">
                <label class="form-label">Usuario</label>
                <input type="text" name="username" id="username" class="form-control capitalize-input" required>
                <div class="invalid-feedback" id="error_username"></div>
            </div>
            <div class="mb-3 col-md-6">
                <label class="form-label">Cargo</label>
                <select name="cargo" id="cargo" class="form-select">
                    <option value="">Selecciona un cargo</option>
                    <option value="administrador">Administrador</option>
                    <option value="tecnico">Técnico</option>
                    <option value="usuario">Usuario</option>
                    <option value="docente">Docente</option>
                </select>
                <div class="invalid-feedback" id="error_cargo"></div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a href="{% url 'users:user_list' %}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>

<script>
    // Enfocar el campo de nombre de usuario al cargar
    document.addEventListener('DOMContentLoaded', function() {
        var usernameInput = document.getElementById('username');
        if (usernameInput) {
            usernameInput.focus();
        }
        // Mayúscula automática en inputs de texto
        document.querySelectorAll('.capitalize-input').forEach(function(input) {
            input.addEventListener('input', function() {
                if (input.value.length > 0) {
                    input.value = input.value.charAt(0).toUpperCase() + input.value.slice(1);
                }
            });
        });
        // Validación en tiempo real
        document.querySelectorAll('input,select').forEach(function(input) {
            input.addEventListener('blur', function() {
                if (!input.checkValidity()) {
                    input.classList.add('is-invalid');
                } else {
                    input.classList.remove('is-invalid');
                }
            });
        });
    });
</script>
{% endblock %}

{% block extra_content %}
<div class="container mt-4">
    <form method="get" action="" class="row g-3 mb-3">
        <div class="col-md-4">
            <input type="text" name="search" class="form-control" placeholder="Buscar por nombre o cédula" value="{{ search }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-outline-primary">Buscar</button>
        </div>
    </form>
</div>
{% endblock %}
